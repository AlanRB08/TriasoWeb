---
// src/components/MobileMenuItem.astro


type MenuItem = {
  title: string;
  url: string;
  children?: MenuItem[];
};

import MobileMenuItem from './MobileMenuItem.astro';
const { item, isFirstLevel = false, level = 0 } = Astro.props;
const hasChildren = item.children && item.children.length > 0;
const submenuId = `submenu-${item.title.toLowerCase().replace(/\s+/g, '-')}`;
---

<li class="font-normal">
  <div class="flex justify-between items-center">
    <a
      href={!hasChildren ? item.url : '#'}
      class="block py-2 px-4 text-grisT hover:bg-grisSubP rounded-md transition-colors w-full text-lg font-bold"
      onclick={isFirstLevel && hasChildren ? `event.preventDefault(); openSubmenu('${submenuId}', 'main-menu')` : ''}
    >
      {item.title}
    </a>

    {hasChildren && isFirstLevel && (
      <button
        class="text-grisT px-4"
        onclick={`openSubmenu('${submenuId}', 'main-menu')`}
        aria-label="Abrir submenú"
      >
        <svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" color="#393939">
          <path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    )}

    {hasChildren && !isFirstLevel && (
      <button class="text-grisT px-4 toggle-submenu-button" data-target={`submenu-${level}-${item.title}`}>
        <svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#393939"><path d="M6 9L12 15L18 9" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      </button>
    )}
  </div>

  <!-- Submenús anidados (niveles > 1) -->
  {hasChildren && !isFirstLevel && (
    <ul
      id={`submenu-${level}-${item.title}`}
      class="ml-4 mt-1 max-h-0 overflow-hidden opacity-0 scale-y-95 transition-all duration-300 space-y-2 border-l border-white/20 pl-4"
    >
      {item.children.map((child: any) => (
        <MobileMenuItem item={child} level={level + 1} />
      ))}
    </ul>
  )}
</li>

<script is:inline>
  // Lógica para submenús anidados (niveles > 1)
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.toggle-submenu-button').forEach(button => {
      button.addEventListener('click', () => {
        const target = button.dataset.target;
        const submenu = document.getElementById(target);
        if (submenu) {
          const isOpen = submenu.classList.contains('max-h-0');
          submenu.classList.toggle('max-h-0', !isOpen);
          submenu.classList.toggle('max-h-[600px]', isOpen);
          submenu.classList.toggle('opacity-0', !isOpen);
          submenu.classList.toggle('opacity-100', isOpen);
          submenu.classList.toggle('scale-y-95', !isOpen);
          submenu.classList.toggle('scale-y-100', isOpen);
        }
      });
    });
  });
</script>